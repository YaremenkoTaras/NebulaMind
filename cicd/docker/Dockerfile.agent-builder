# Multi-stage build for agent-builder
FROM maven:3.9-amazoncorretto-21 AS build

WORKDIR /app

# Copy Maven configuration and source
COPY app/agent-builder/pom.xml ./
COPY app/agent-builder/src ./src
COPY app/agent-builder/.mvn ./.mvn

# Build the application
RUN mvn clean package -DskipTests

# Runtime stage
FROM amazoncorretto:21-alpine

WORKDIR /app

# Install curl for healthcheck
RUN apk add --no-cache curl

# Copy built JAR from build stage
COPY --from=build /app/target/agent-builder-0.1.0-SNAPSHOT.jar app.jar

# Create logs directory
RUN mkdir -p /app/logs

# Expose port
EXPOSE 8082

# Run the application
ENTRYPOINT ["java", "-jar", "app.jar"]

